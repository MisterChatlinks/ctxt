var Te=Object.defineProperty,Ze=Object.defineProperties;var Xe=Object.getOwnPropertyDescriptors;var we=Object.getOwnPropertySymbols;var Qe=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable;var xe=t=>{throw TypeError(t)};var ke=(t,e,r)=>e in t?Te(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,m=(t,e)=>{for(var r in e||(e={}))Qe.call(e,r)&&ke(t,r,e[r]);if(we)for(var r of we(e))et.call(e,r)&&ke(t,r,e[r]);return t},te=(t,e)=>Ze(t,Xe(e));var tt=(t,e)=>{for(var r in e)Te(t,r,{get:e[r],enumerable:!0})};var Se=(t,e,r)=>e.has(t)||xe("Cannot "+r);var O=(t,e,r)=>(Se(t,e,"read from private field"),r?r.call(t):e.get(t)),ve=(t,e,r)=>e.has(t)?xe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),Ce=(t,e,r,o)=>(Se(t,e,"write to private field"),o?o.call(t,r):e.set(t,r),r);var y=(t,e,r)=>new Promise((o,i)=>{var s=c=>{try{a(r.next(c))}catch(l){i(l)}},n=c=>{try{a(r.throw(c))}catch(l){i(l)}},a=c=>c.done?o(c.value):Promise.resolve(c.value).then(s,n);a((r=r.apply(t,e)).next())});function D(t){if(t===null||typeof t!="object"||t instanceof Function)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t);if(Array.isArray(t))return t.map(r=>D(r));let e={};for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=D(t[r]));return e}function S(t){return!!(typeof t=="function"&&t.toString().trimStart().match(/^async/))}function rt(t){return typeof t=="number"}function E(t){return typeof t=="number"&&!(t<0)}function ot(t){return typeof t=="number"&&!(t<0)}function A(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function F(t){if(t instanceof Date)return!isNaN(t.getTime());if(typeof t=="string"||typeof t=="number"){let e=new Date(t);return!isNaN(e.getTime())}return!1}function K(t,e){let r=m({},t);for(let o in e){let i=e[o],s=r[o];A(i)&&A(s)?r[o]=K(s,i):r[o]=i}return r}function v(t,...e){return`[Monitext[${t}]] ${e.join("")}`}function M(t,...e){if(!e||e==null||e==null||!t||!Array.isArray(e)||typeof t!="object")throw new Error(v("extractKeys",`Expected an object and an array of keys. Received:
Target: ${JSON.stringify(t)}
Keys: ${JSON.stringify(e)}`));let r={};for(let o of e){if(o==null||e==null||!(o in t))throw new Error(v("extractKeys",`Key "${String(o)}" does not exist on target object`));let i=t[o];r[o]=typeof i=="function"?i.bind(t):i}return r}var b=class{constructor(e){this.overrides={};this.baseConfig=m({},e)}merge(e,r=!1){return this.overrides=r?K(this.overrides,e):m(m({},this.overrides),e),this}toObject(){return m(m({},this.baseConfig),K(this.baseConfig,this.overrides))}toString(){return JSON.stringify(this.toObject())}get(e){var r;return(r=this.overrides[e])!=null?r:this.baseConfig[e]}};function L(t,e){return function(r){return e&&e(r),new b(t.toObject()).merge(r,!0).toObject()}}var nt={showEnv:!0,showTimestamp:!0,showContext:!0,showConfig:!1,showCallerName:!0,showFileName:!0,showLineNumber:!0,showColumnNumber:!1,showFullTrace:!1,showTraceInfo:!0},Le=L(new b(nt)),$e=Le({showFullTrace:!0}),R=Le({showColumnNumber:!1}),Pe=L(new b({mode:"dev",info:R,warn:R,error:$e,fatal:$e,trace:R,profile:R,failure:R,success:R}));var je=L(new b({apiKey:"",project:"",silence:[],transportInterval:3e4,transportationRetryDelay:100,transportMaxRetryPerTransport:5,transportOnFailRetryAfter:12e4}));var B=class{constructor(e){if(!e.name)throw new Error("[MoniTextPolicy] Every policy must have a name");this.descriptor=m({phase:"core",priority:0},e)}get name(){return this.descriptor.name}get phase(){return this.descriptor.phase}apply(e,r,o){this.descriptor.handle(e,r,o)}matches(e){let{level:r,filter:o}=this.descriptor;return(!r||r.includes(e.level))&&(!o||o(e))}};function _(t,e,r,o="core"){return new Promise(i=>{let s=t.filter(c=>c.phase===o&&c.matches(e)).sort((c,l)=>c.descriptor.priority-l.descriptor.priority),n=0,a=()=>{let c=s[n++];c?c.apply(e,r,a):i(!0)};a()})}function Ee(t){return t.match(/^[a-zA-Z\d_]*\:\//)||t.match(/^[a-zA-Z\d_]*\:\//)||t.match(/^[a-zA-Z\d_]*\:\//)||t.startsWith("/")?t:`/${t}`}function Re(t){return t.endsWith("/")?t:`${t}/`}function Be(t){let e=t.match(/\(file:\/\/\/(.+?):\d+:\d+\)/);if(!e)return null;let o=e[1].split("/");return o.pop(),Re(Ee(o.join("/")))}var re=class{constructor(e,r,o,i,s){this.callerName=e;this.fileName=r;this.lineNumber=o;this.columnNumber=i;this.fullTrace=s}};var st=t=>typeof t=="object"&&t!==null&&["node","deno","bun","browser"].every(e=>typeof t[e]=="number"),V=class{constructor({node:e,deno:r,bun:o,browser:i,defaults:s}){this.node=e||2,this.deno=r||2,this.bun=o||2,this.browser=i||2,this.defaults=s||2}};function C(t){var g;let e=(g=Error().stack)==null?void 0:g.split(`
`).map(p=>p.trim()).slice(1);if(typeof t!="number"){let p=t;if(t instanceof V)t=t[d.detectEnv()]||t.defaults;else if(st(p))t=new V(p),t=t[d.detectEnv()]||t.defaults;else return console.warn("[lookUpInStack] Invalid `at` value. Expected number or LookSetup-compatible object, received:",t),{fullTrace:e}}let r=e.length-1;if(t<0||t>r||!Number.isInteger(t))return console.warn(`[lookUpInStack] invalid \`at\` index, must be between 0 and ${r}; received: ${t}`),{fullTrace:e};let o=e[t].replace(/^at/,"").trim().split(" "),i=o.length;if(!o||i===0)return console.warn(`[lookUpInStack] No valid stack trace found at index ${t}`),{fullTrace:e};let s=i>1,n=s?o[0]:"<unknown>",a=s?o.slice(1).join(""):o[0],c=a.split(":"),l=c.length,u=l>2?c[l-2]:c[l-1].replace(")",""),f=l>2?c[l-1]:"0";return new re(n,a.replace(/\:\d*\:\d*$/,""),u,f.replace(")",""),e)}var Ie,Fe,d=class{static detectEnv(){var e;if(typeof window!="undefined"&&typeof document!="undefined")return"browser";if(typeof Deno!="undefined")return"deno";if(typeof Bun!="undefined")return"bun";if(typeof process!="undefined"&&(process!=null&&process.versions)&&((e=process==null?void 0:process.versions)!=null&&e.node))return"node"}};d.basePath=Be(((Fe=(Ie=new Error)==null?void 0:Ie.stack)!=null?Fe:"")[1]||"");var W={reset:"color: inherit; background-color: inherit; font-weight: normal; font-style: normal; text-decoration: none; opacity: 1; filter: none;",bold:"font-weight: bold;",dim:"opacity: 0.6;",italic:"font-style: italic;",underline:"text-decoration: underline;",inverse:"filter: invert(100%);",hidden:"opacity: 0;",strikethrough:"text-decoration: line-through;",black:"color: black;",red:"color: red;",green:"color: green;",yellow:"color: yellow;",blue:"color: blue;",magenta:"color: magenta;",cyan:"color: cyan;",white:"color: white;",gray:"color: gray;",grey:"color: grey;",blackBright:"color: #3f3f3f;",redBright:"color: #ff0000;",greenBright:"color: #00ff00;",yellowBright:"color: #ffff00;",blueBright:"color: #0000ff;",magentaBright:"color: #ff00ff;",cyanBright:"color: #00ffff;",whiteBright:"color: #ffffff;",bgBlack:"background-color: black;",bgRed:"background-color: red;",bgGreen:"background-color: green;",bgYellow:"background-color: yellow;",bgBlue:"background-color: blue;",bgMagenta:"background-color: magenta;",bgCyan:"background-color: cyan;",bgWhite:"background-color: white;",bgGray:"background-color: gray;",bgGrey:"background-color: grey;",bgBlackBright:"background-color: #3f3f3f;",bgRedBright:"background-color: #ff0000;",bgGreenBright:"background-color: #00ff00;",bgYellowBright:"background-color: #ffff00;",bgBlueBright:"background-color: #0000ff;",bgMagentaBright:"background-color: #ff00ff;",bgCyanBright:"background-color: #00ffff;",bgWhiteBright:"background-color: #ffffff;"};import it from"chalk";function Ue(t,...e){return`[mtxt-style[${t}]]${e.join("")}[mtxt-style-end]`}var at=/(\[mtxt-style\[[^\]]+\]\])|(\[mtxt-style-end\])/g,Me=/\[mtxt-style\[([^\]]+)\]\]/,ct="[mtxt-style-end]";function Ne(t){let e=t.split(at).filter(Boolean),r=[],o=[],i=s=>{o.length>0?o[o.length-1].content.push(s):r.push(s)};for(let s of e)if(Me.test(s)){let[,n]=s.match(Me),a={style:n.split(" "),content:[]};o.push(a)}else if(s===ct){let n=o.pop();i(n)}else i(s);return r}function oe(t){return t.map(r=>{if(typeof r=="string")return r;let o=oe(r.content);return r.style.reduce((s,n)=>{var a;return(a=s[n])!=null?a:s},it)(o)}).join("")}function Oe(t){let e="",r=[],o=(i,s="")=>{for(let n of i)if(typeof n=="string")e+="%c"+n,r.push(s);else{let a=n.style.map(lt).join("; ")+";";o(n.content,a)}};return o(t),[e,r]}function lt(t){return W[t]||""}function ut(t){return function(...e){return Ue(t,...e)}}var De={};for(let t of Object.keys(W))De[t]=ut(t);var z=De;var{green:ar,bold:cr,gray:ft}=z;function Ae(t="",e={}){var f,g,p;let r=ne(80),o=(f=e.char)!=null?f:"\u2500",i=(g=e.color)!=null?g:ft,s=" ".repeat((p=e.padding)!=null?p:1),n=t?`${s}${t.trim()}${s}`:"",a=Math.max(0,r-n.length),c=Math.floor(a/2),l=a-c,u=o.repeat(c)+n+o.repeat(l);return i(u)}function ne(t=80){var r,o;switch(d.detectEnv()){case"bun":return((r=process.stdout)==null?void 0:r.columns)||t;case"node":return((o=process.stdout)==null?void 0:o.columns)||t;case"deno":return Deno.consoleSize().columns||t;case"browser":let i;try{return i=Math.floor(window.innerWidth/8),i>0?i:t}catch(s){return t}default:return t}}function U(t,e=d.detectEnv()){let r="",o=[];t(Ae,z,function(c){o.push(c)},function(c){r=c});let n=Ne(o.flat().join(r));return e==="browser"?Oe(n).flat():[oe(n)]}function Ke(t,e){return{header(r,o){let i=t.getTheme(r),s=e[i.color],n=e[i.headerStyle||"bold"];return[`${n(s(`${i.icon} [${r.toUpperCase()}]`))} ${e.whiteBright(o.join(" "))}`]},trace(r,o){let i=t.getTheme(r),s=[];return s.push(`${e[i.metaLabelColor||"white"](`\u{1F4CC} StackTraceInfo:
`)}`),o.callerName&&s.push(`    \u2022 ${e.bold("Caller:")}   ${o.callerName}`),o.fileName&&s.push(`    \u2022 ${e.bold("File:")}     ${o.fileName}`),o.lineNumber&&s.push(`    \u2022 ${e.bold("Line:")}     ${o.lineNumber}`),o.columnNumber&&s.push(`    \u2022 ${e.bold("Column:")}   ${o.columnNumber}`),s},fullTrace(r,o){let i=t.getTheme(r),s=[];return s.push(`${e[i.metaLabelColor||"white"](`\u{1F4DC} Full Trace:
`)}`),Array.isArray(o)&&o.length>0?s.push(...o.map(n=>`   - ${n}`)):s.push("   No stack trace available."),s},context(r,o){let i=t.getTheme(r),s=[];if(s.push(`${e[i.contextColor||"white"]("\u{1F4E6} Context:")}`),!o)return["   - No context available."];if(typeof o!="object"||Object.keys(o).length!==0)return[`   - ${o}`];let n=Object.entries(o).map(([a,c])=>`   - ${a}: ${c}`).join("");return n.trim()==""?[" - No context available."]:s.concat(n)},config(r,o){let i=t.getTheme(r),s=[];return s.push(`
${e[i.configColor||"white"]("\u2699\uFE0F  Config:")}`),o?typeof o!="object"?[`   - ${o}`]:s.concat(Object.entries(o).map(([n,a])=>`   - ${n}: ${a}`)):["   - No config available."]},separator(r,o="",i="center",s){var pe,me,ge,ye,de,he,be;let n=t.getTheme(r),a=(pe=n.separatorChar)!=null?pe:"-",c=e[n.color],l=ne(),u=e[(ge=(me=s==null?void 0:s.style)!=null?me:n.separatorStyle)!=null?ge:"bold"],f=(de=(ye=s==null?void 0:s.transform)!=null?ye:n.textTransform)!=null?de:"none",g=(be=(he=s==null?void 0:s.icon)!=null?he:n.showIconInSeparator)!=null?be:!0,p=o.trim();f==="uppercase"&&(p=p.toUpperCase()),f==="capitalize"&&(p=p[0].toUpperCase()+p.slice(1)),g&&(p=`${n.icon} ${p}`);let T=`${i=="center"?" ":""}${p} `,h=Math.max(0,l-T.length),x=i==="center"?Math.floor(h/2):0,Q=Math.floor(h)-x,ee=(a.repeat(x)+T+a.repeat(Q)).split("");for(;l-1<ee.length;)ee.pop();return[c(u(ee.join("")))]}}}var se={};tt(se,{isAsyncFunction:()=>S,isNegativeNumber:()=>ot,isNumber:()=>rt,isObject:()=>A,isPositiveNumber:()=>E,isValidDate:()=>F,resolveType:()=>G});function G(t){if(t===null)return"null";if(t===void 0)return"undefined";if(Array.isArray(t))return"array";let e=typeof t;return["string","number","boolean","function"].includes(e)?e:e==="object"?"object":"unknown"}var _e={dev(t,e,r){let o=U((i,s,n,a)=>{a(`
`);let{dim:c,bold:l}=s,u=t.toObject(),f=Ke(e,s),g=u.level,p=Array.isArray(u.message)?u.message:[u.message],T=u.meta,h=r[g];n(""),n(f.separator(g,`[${[g]}]`,"left",{transform:"uppercase",style:"bold"})),n(""),n(p.join()),h.showTraceInfo&&(n(""),f.trace(g,T).forEach(n)),h.showFullTrace&&(n(""),f.fullTrace(g,T.fullTrace).forEach(n)),h.showContext&&(n(""),f.context(g,u.context).forEach(n)),h.showConfig&&(n(""),f.config(g,u.config).forEach(n));let x="";h.showEnv&&(x+=`${d.detectEnv()}, `,x=[x[0].toUpperCase(),x.split("").splice(1).join("").toLowerCase()].join("")),h.showTimestamp&&(x+=`At ${F(u.timestamp)?new Date(u.timestamp).toLocaleString():new Date().toLocaleString()}`),n(""),n(x),n(i("",{char:l("\u2500"),color:Q=>l(c(Q))}))});console.log(...o)}};var J=class{constructor(e,r){this.themes=r,this.currentTheme=e}use(e){if(!(e in this.themes))throw new Error(`Theme "${e}" not found.`);this.currentTheme=e}getTheme(e){return m(m({},this.themes.common||{}),this.themes[this.currentTheme][e])}get current(){return this.currentTheme}listThemes(){return Object.keys(this.themes)}};var Ve={common:{contextColor:"white",configColor:"white",metaLabelColor:"white",separatorChar:"\u2501",headerStyle:"white"},info:{icon:"\u{1F7E6}",color:"blue",traceColor:"cyan"},warn:{icon:"\u26A0\uFE0F",color:"yellow",traceColor:"yellow"},error:{icon:"\u{1F7E5}",color:"red",traceColor:"red"},success:{icon:"\u2705",color:"green",traceColor:"green"},failure:{icon:"\u274C",color:"yellowBright",traceColor:"yellowBright"},fatal:{icon:"\u{1F480}",color:"redBright",traceColor:"redBright"},trace:{icon:"\u{1F50D}",color:"magenta",traceColor:"cyan"},profile:{icon:"\u23F1\uFE0F",color:"cyan",traceColor:"cyan"}};var We=new J("default",{default:Ve});var ze=new B({name:"log-on-console-policy",phase:"core",handle:function(t,e,r){_e.dev(t,We,e.format),r()}});var Ge={createConfig:je,createFormating:Pe,policies:[ze]};var ie={default:Ge};function pt(t){if(!ie[t])throw`[Monitext[getPolicyRecord]] The requested record "${t}" could not be found;
[Availables] ${Object.keys(ie).map(function(e){return`
   - ${e}`}).join("")}`;return ie[t]}function w(t){let e=Math.floor(t/1e3),r=Math.floor(e/3600),o=e%3600,i=Math.floor(o/60),s=o%60,n=t%1e3;return{hours:r,minutes:i,seconds:s,milliseconds:n}}function k(t){let e=[],r=(o,i,s)=>`${o} ${o===1?i:s}`;return t.hours&&e.push(r(t.hours,"hour","hours")),t.minutes&&e.push(r(t.minutes,"minute","minutes")),t.seconds&&e.push(r(t.seconds,"second","seconds")),(t.milliseconds||e.length===0)&&e.push(r(t.milliseconds,"millisecond","milliseconds")),e.join(" ")}function Je(t){if(t instanceof Date&&!isNaN(t.getTime()))return t;if(typeof t=="string"||typeof t=="number"){let e=new Date(t);return isNaN(e.getTime())?null:e}return null}var P,ce=class ce{constructor(e={}){ve(this,P);Ce(this,P,e),this._struct=Object.assign({},e),typeof(this==null?void 0:this.validate)=="function"&&this.validate()}toObject(){return D(this._struct)}clone(e={}){return new this.constructor(m(m({},this.toObject()),e))}patch(e={}){return Object.assign(this._struct,e),typeof(this==null?void 0:this.validate)=="function"&&this.validate(),this}describe(){let e={},r=O(this,P);for(let o of Object.keys(O(this,P))){let i=O(this,P)[o],s=G(i);s==="object"&&i&&typeof i=="object"&&!Array.isArray(i)?e[o]={type:"object",required:!0,properties:Object.fromEntries(Object.entries(i).map(([n,a])=>[n,{type:G(a),default:a,required:a!=null&&a!=null}]))}:e[o]={type:s,default:i,required:!0}}return e}pick(...e){let r=this.toObject(),o={};for(let i of e)o[i]=r[i];return o}omit(...e){let r=this.toObject(),o=m({},r);for(let i of e)delete o[i];return o}pickStruct(...e){var i;let r=this,o=this.pick(...e);return new class extends ce{constructor(){super(...arguments);this.validate=(i=r==null?void 0:r.validate)==null?void 0:i.bind(this)}}(o)}};P=new WeakMap;var ae=ce;function I(t,e){class r extends ae{constructor(i){super(m(m({},t),i))}validate(){e&&e.call(this._struct)}}return r}var mt={install:void 0},He=I(mt);var gt={ready:!1,level:"info",subLevels:[],context:{},config:{},message:[],meta:void 0,env:d.detectEnv(),timestamp:void 0,identifyer:void 0},$=I(gt,function(){var t,e;if(typeof this.identifyer!="symbol")throw new TypeError(v("LogInstance",'expected a symbol as "identifyer"; received: ',(t=this.identifyer)==null?void 0:t.toString()));if(typeof this.timestamp!="string"||!F(this.timestamp))throw new TypeError(v("LogInstance",'expected an ISO string or any valid form of date as "timestamp"; received: ',(e=this.timestamp)==null?void 0:e.toString()))});var H=class{constructor(e){this.subscribers=[];this.levelHandlers={};this.config=M(e,"config","format")}handle(e){return y(this,null,function*(){(this.levelHandlers[e.toObject().level]||[]).forEach(o=>o(e,this.config)),this.subscribers.forEach(o=>o(e,this.config))})}subscribe(e){this.subscribers.push(e)}on(e,r){this.levelHandlers[e]||(this.levelHandlers[e]=[]),this.levelHandlers[e].push(r)}};var yt={fn:function(){}},dt=yt.fn;S(dt);var le=class{constructor(e,r=!1){this.name=e;this.ready=r}},ue=class{constructor(e,r){this.jobs=e;this.submit=r;this.scheduled=!1}},Y=class{constructor(e,r=10){this.chainStrength=r;this.ref=new ue({},e)}initJobs(e){let r={};for(let o of e)r[o]=new le(o,!0);return this.ref.jobs=r,this.scheduleIfReady(),this.createProxy()}scheduleIfReady(){this.ref.scheduled!==!0&&(this.ref.scheduled=!0,this.ref.interval=setInterval(()=>{Object.values(this.ref.jobs).every(r=>r.ready===!0)&&(this.submit(),clearInterval(this.ref.interval))},this.chainStrength))}submit(){return y(this,null,function*(){if(typeof this.ref.submit=="function"){let e=yield this.ref.submit(this.ref.param);this.ref.resolveCallback&&this.ref.resolveCallback(e)}})}then(e,r){this.ref.resolveCallback=e}createProxy(){return new Proxy(this,{get:(e,r,o)=>{let i=Reflect.get(e,r,o);return typeof i=="function"&&this.ref.jobs[r]?(this.ref.jobs[r].ready=!1,(...s)=>(y(this,null,function*(){let n=i;S(i)?yield n.apply(e,s):n.apply(e,s),this.ref.jobs[r].ready=!0,this.scheduleIfReady()}),this.createProxy())):i}})}};var q=class extends Y{constructor({log:e,onSubmit:r}){return super(r),this.ref.param=e.toObject(),this.initJobs(["context","config"])}context(e){return this.ref.param.context=e,delete this.context,this.createProxy()}config(e){this.ref.param.config=e,delete this.config}};var j=class t{constructor(e,r,o){this.ok=e,this.value=r,this.error=o}static ok(e){return new t(!0,e)}static fail(e){return new t(!1,void 0,e)}};var Z=class{constructor(e,r,o){this.target=r;this.callRecord=[];S(e)?this.body=this.loadAsAsync(e,o):this.body=this.loadAsSync(e,o)}build(){return this.body}updateProfile(e,r,o,i){return y(this,null,function*(){if(this.callRecord.push(e),this.callRecord.length!==o)return;let s=k(w(Math.min(...this.callRecord))),n=k(w(Math.max(...this.callRecord))),a=this.callRecord.reduce((p,T)=>p+T),c=k(w(a/o)),l=k(w(a)),f=(this.callRecord.filter(p=>p<r).length/o*100).toFixed(1)+"%",g=`[Profiler] ${o} calls completed in ${l}:

 \u2022 Average time per call: ${c}
 \u2022 Fastest: ${s}, Slowest: ${n}
 \u2022 ${f} of calls completed within expected time range (expected: \u2264 ${k(w(r))})`;this.emit("info",g,i)})}repportProfilingError(e,r){return y(this,null,function*(){this.emit("error",`[Profiler][Error: (${e.name})]: ${e.message}`,r)})}reportTimingDiscrepancy(e,r,o){return y(this,null,function*(){let i=w(e),s=w(r);this.emit("warn",`[Profiling Warning] Execution time exceeded. Expected: ${k(s)}, actual: ${k(i)}`,o)})}emit(e,r,o){this.target.handle(new $({level:"profile",subLevels:[e],message:Array.isArray(r)?r:[r],meta:o,ready:!0,identifyer:Symbol(),timestamp:new Date().toISOString()}))}loadAsAsync(e,{expectDuration:r,forAverageOf:o}){let i=this;return(...s)=>y(this,null,function*(){let n,a,c,l,u=C({node:2,deno:2,bun:3,browser:2,defaults:2});try{c=c=Date.now(),n=yield e(...s),l=Date.now()-c}catch(f){l=Date.now()-c,a=f}return a?(i.repportProfilingError(a,u),j.fail(a)):(y(this,null,function*(){E(r)&&r<l&&i.reportTimingDiscrepancy(l,r,u),E(o)&&i.updateProfile(l,r,o,u)}),j.ok(n))})}loadAsSync(e,{expectDuration:r,forAverageOf:o}){let i=this;return(...s)=>{let n,a,c,l,u=C({node:2,deno:2,bun:2,browser:2,defaults:2});try{c=c=Date.now(),n=e(...s),l=Date.now()-c}catch(f){l=Date.now()-c,a=f}return a?(i.repportProfilingError(a,u),j.fail(a)):(y(this,null,function*(){E(r)&&r<l&&i.reportTimingDiscrepancy(l,r,u),E(o)&&i.updateProfile(l,r,o,u)}),j.ok(n))}}};import{parse as Ye}from"acorn";import{walk as qe}from"estree-walker";import*as fe from"astring";var X=class{constructor(e){this.fn=e;this.keywords={useThrow$:"__throw$",useTrace$:"__trace$",traceDec$:"__traced$",fnTracer$:"__fnTracer$",makeResult$:"__mkResult$",passedArgs$:"__callArgs$"};this.traceWrapperFnBody=`function ${this.keywords.traceDec$}(fn) {
        fn.${this.keywords.useTrace$} = ${this.keywords.fnTracer$}
        fn.${this.keywords.useThrow$} = (e) => { throw new Error(e); }
        return fn;
    }`;this.runCode=(e,r={})=>{let o=Object.keys(r),i=Object.values(r);return new Function(...o,`"use strict";
${e}`)(...i)}}build(){let e=this,r=`(${this.removeSemiColon(this.fn.toString())})(...${this.keywords.passedArgs$})`,o=`${this.wrapFunctionDeclarationsWith(this.wrapFnCallsWith(r))}`,i=`
        Function.prototype.${this.keywords.useTrace$} = ${this.keywords.fnTracer$}
        Function.prototype.${this.keywords.useThrow$} = (e)=> { throw new Error(e); }
        ${this.traceWrapperFnBody}
        `,s=S(this.fn),n=[],a={[this.keywords.fnTracer$]:this.makeFnTracer(n),[this.keywords.makeResult$]:null},c=`(${s?"async":""} function (){
                try {                
                    ${i}
                    const result = ${s?"await":""} ${o}
                    ${this.keywords.makeResult$}({ ok: true, value: result })
                } catch (e){            
                    console.log(\`[TRACE ERROR (\${e.name})] \${e.message}\`)
                    ${this.keywords.makeResult$}({ ok: false, error: e })
                }
            })()`;return s?function(l){return y(this,null,function*(){return yield new Promise(u=>{a[e.keywords.makeResult$]=u,a[e.keywords.passedArgs$]=[l],e.runCode(c,a),console.log(JSON.stringify(n,null,2))}).then(u=>te(m({},u||{}),{exec:n}))})}:function(l){let u;return a[e.keywords.passedArgs$]=[l],a[e.keywords.makeResult$]=f=>{u=f},e.runCode(c,a),console.log(JSON.stringify(n,null,2)),te(m({},u||{}),{exec:n})}}removeSemiColon(e){return e.trimEnd().replace(/\;$/,"")}uuid(){return Date.now()}makeFnTracer(e){let r=this;return function(o,i=this){return function(...s){let n={};e.push(n),n.start=Date.now(),n.label=o||(i==null?void 0:i.name)||i.toString(),n.arguments=s;try{let a=i.apply(this,s);return n.result=a,n.duration=`${(Date.now()-n.start).toFixed(2)} ms`,a}catch(a){n.error={message:`Tracing ${a==null?void 0:a.name} ${a==null?void 0:a.message}`},n.duration=`${(Date.now()-n.start).toFixed(2)} ms`,i[r.keywords.useThrow$](a)}}}}wrapFunctionDeclarationsWith(e){let r=this,o=Ye(e,{ecmaVersion:2022,sourceType:"module"}),i=[];qe(o,{enter(s,n){var a,c;if(s.type==="VariableDeclarator"&&(((a=s.init)==null?void 0:a.type)==="ArrowFunctionExpression"||((c=s.init)==null?void 0:c.type)==="FunctionExpression")&&(s.init={type:"CallExpression",callee:{type:"Identifier",name:r.keywords.traceDec$},arguments:[s.init]}),s.type==="FunctionDeclaration"&&(n==null?void 0:n.type)==="Program"){let{id:l,params:u,body:f,generator:g,async:p}=s,T={type:"FunctionExpression",id:l,params:u,body:f,generator:g,async:p},h={type:"VariableDeclaration",kind:"const",declarations:[{type:"VariableDeclarator",id:l,init:{type:"CallExpression",callee:{type:"Identifier",name:r.keywords.useTrace$},arguments:[T]}}]};i.push({node:s,replacement:h})}}});for(let{node:s,replacement:n}of i){let a=o.body.indexOf(s);a!==-1&&o.body.splice(a,1,n)}return fe.generate(o)}wrapFnCallsWith(e){let r=this,o=Ye(e,{ecmaVersion:2022,sourceType:"module"});return qe(o,{enter(i,s){if(i.type==="CallExpression"&&i.callee.type==="Identifier"){let n=i.callee;i.callee={type:"CallExpression",callee:{type:"MemberExpression",object:n,property:{type:"Identifier",name:r.keywords.useTrace$},computed:!1,optional:!1},arguments:[{type:"Literal",value:n!=null&&n.name?"string":"null",raw:n!=null&&n.name?`"${n==null?void 0:n.name}"`:void 0}],optional:!1}}}}),fe.generate(o)}};var N=class{constructor(e,r){this.bus=e;this.mode=r;this.commonLevel=["info","warn","error","fatal","success","failure"];for(let o of this.commonLevel)this[o]=r==="compact"?this.createCompactLogEmitter(o):this.createChainableLogEmitter(o)}createCompactLogEmitter(e){return(r,o)=>{let{config:i,context:s}=o||{};s&&(s=typeof s=="object"?s:{$value:s});let n=new $({level:e,message:[r],context:s,meta:C(2),config:i,ready:!0,identifyer:Symbol(),timestamp:new Date().toISOString()});return this.bus.handle(n),n}}createChainableLogEmitter(e){let r=this;return(...o)=>new q({log:new $({message:o,level:e,meta:C({bun:2,node:2,deno:2,browser:2,defaults:2}),ready:!0,identifyer:Symbol(),timestamp:new Date().toISOString()}),onSubmit(s){let{context:n}=s||{};n&&(s.context=typeof n=="object"?n:{$value:n}),r.bus.handle(new $(s))}})}profile(e,r){return new Z(e,this.bus,r).build()}trace(e,r){return new X(e).build()}};var rn={lookUpInStack:C,parseDate:Je,extractKeys:M,check:se,convertTime:w,writeTimeString:k},on={createStructFromShape:I,createConfigResolver:L,writeColoredString:U,PolicyInstance:He,LogInstance:$,Config:b};function nn(t){var i,s;let e=(s=(i=t==null?void 0:t.load)==null?void 0:i.flat().filter(n=>n instanceof B))!=null?s:[],r=new H(M(t,"config","format"));return r.subscribe((n,a)=>y(null,null,function*(){try{yield _(e,n,a,"pre"),yield _(e,n,a,"core"),yield _(e,n,a,"post")}catch(c){console.warn(...U(function(l,u,f){let{bold:g}=u;f(l("MONITEXT - SYS GUARD")),f(g(v("MonitextFailSafe",`A Critical Error as occured inside Monitext Logging Policy;
Cause: ${c.message}
${c==null?void 0:c.stack}`))),f(l("MONITEXT - SYS GUARD"))}))}})),{mtxt:new N(r,"compact"),monitext:new N(r,"chainable")}}export{nn as createRuntime,pt as getPolicyRecord,on as tools,rn as utils};
//!!! TO DO REMOVE THIS DOWN HERE
