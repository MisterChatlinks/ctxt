"use strict";var ot=Object.create;var F=Object.defineProperty,nt=Object.defineProperties,st=Object.getOwnPropertyDescriptor,it=Object.getOwnPropertyDescriptors,at=Object.getOwnPropertyNames,xe=Object.getOwnPropertySymbols,ct=Object.getPrototypeOf,ve=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var Ce=t=>{throw TypeError(t)};var Se=(t,e,r)=>e in t?F(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,m=(t,e)=>{for(var r in e||(e={}))ve.call(e,r)&&Se(t,r,e[r]);if(xe)for(var r of xe(e))lt.call(e,r)&&Se(t,r,e[r]);return t},re=(t,e)=>nt(t,it(e));var $e=(t,e)=>{for(var r in e)F(t,r,{get:e[r],enumerable:!0})},Le=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of at(e))!ve.call(t,n)&&n!==r&&F(t,n,{get:()=>e[n],enumerable:!(o=st(e,n))||o.enumerable});return t};var Pe=(t,e,r)=>(r=t!=null?ot(ct(t)):{},Le(e||!t||!t.__esModule?F(r,"default",{value:t,enumerable:!0}):r,t)),ut=t=>Le(F({},"__esModule",{value:!0}),t);var je=(t,e,r)=>e.has(t)||Ce("Cannot "+r);var D=(t,e,r)=>(je(t,e,"read from private field"),r?r.call(t):e.get(t)),Ee=(t,e,r)=>e.has(t)?Ce("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),Re=(t,e,r,o)=>(je(t,e,"write to private field"),o?o.call(t,r):e.set(t,r),r);var y=(t,e,r)=>new Promise((o,n)=>{var i=c=>{try{a(r.next(c))}catch(l){n(l)}},s=c=>{try{a(r.throw(c))}catch(l){n(l)}},a=c=>c.done?o(c.value):Promise.resolve(c.value).then(i,s);a((r=r.apply(t,e)).next())});var Lt={};$e(Lt,{createRuntime:()=>$t,getPolicyRecord:()=>et,tools:()=>Ct,utils:()=>vt});module.exports=ut(Lt);function A(t){if(t===null||typeof t!="object"||t instanceof Function)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t);if(Array.isArray(t))return t.map(r=>A(r));let e={};for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=A(t[r]));return e}function S(t){return!!(typeof t=="function"&&t.toString().trimStart().match(/^async/))}function ft(t){return typeof t=="number"}function E(t){return typeof t=="number"&&!(t<0)}function pt(t){return typeof t=="number"&&!(t<0)}function K(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function M(t){if(t instanceof Date)return!isNaN(t.getTime());if(typeof t=="string"||typeof t=="number"){let e=new Date(t);return!isNaN(e.getTime())}return!1}function _(t,e){let r=m({},t);for(let o in e){let n=e[o],i=r[o];K(n)&&K(i)?r[o]=_(i,n):r[o]=n}return r}function v(t,...e){return`[Monitext[${t}]] ${e.join("")}`}function U(t,...e){if(!e||e==null||e==null||!t||!Array.isArray(e)||typeof t!="object")throw new Error(v("extractKeys",`Expected an object and an array of keys. Received:
Target: ${JSON.stringify(t)}
Keys: ${JSON.stringify(e)}`));let r={};for(let o of e){if(o==null||e==null||!(o in t))throw new Error(v("extractKeys",`Key "${String(o)}" does not exist on target object`));let n=t[o];r[o]=typeof n=="function"?n.bind(t):n}return r}var b=class{constructor(e){this.overrides={};this.baseConfig=m({},e)}merge(e,r=!1){return this.overrides=r?_(this.overrides,e):m(m({},this.overrides),e),this}toObject(){return m(m({},this.baseConfig),_(this.baseConfig,this.overrides))}toString(){return JSON.stringify(this.toObject())}get(e){var r;return(r=this.overrides[e])!=null?r:this.baseConfig[e]}};function L(t,e){return function(r){return e&&e(r),new b(t.toObject()).merge(r,!0).toObject()}}var mt={showEnv:!0,showTimestamp:!0,showContext:!0,showConfig:!1,showCallerName:!0,showFileName:!0,showLineNumber:!0,showColumnNumber:!1,showFullTrace:!1,showTraceInfo:!0},Ie=L(new b(mt)),Be=Ie({showFullTrace:!0}),R=Ie({showColumnNumber:!1}),Fe=L(new b({mode:"dev",info:R,warn:R,error:Be,fatal:Be,trace:R,profile:R,failure:R,success:R}));var Me=L(new b({apiKey:"",project:"",silence:[],transportInterval:3e4,transportationRetryDelay:100,transportMaxRetryPerTransport:5,transportOnFailRetryAfter:12e4}));var B=class{constructor(e){if(!e.name)throw new Error("[MoniTextPolicy] Every policy must have a name");this.descriptor=m({phase:"core",priority:0},e)}get name(){return this.descriptor.name}get phase(){return this.descriptor.phase}apply(e,r,o){this.descriptor.handle(e,r,o)}matches(e){let{level:r,filter:o}=this.descriptor;return(!r||r.includes(e.level))&&(!o||o(e))}};function V(t,e,r,o="core"){return new Promise(n=>{let i=t.filter(c=>c.phase===o&&c.matches(e)).sort((c,l)=>c.descriptor.priority-l.descriptor.priority),s=0,a=()=>{let c=i[s++];c?c.apply(e,r,a):n(!0)};a()})}function Ue(t){return t.match(/^[a-zA-Z\d_]*\:\//)||t.match(/^[a-zA-Z\d_]*\:\//)||t.match(/^[a-zA-Z\d_]*\:\//)||t.startsWith("/")?t:`/${t}`}function Ne(t){return t.endsWith("/")?t:`${t}/`}function Oe(t){let e=t.match(/\(file:\/\/\/(.+?):\d+:\d+\)/);if(!e)return null;let o=e[1].split("/");return o.pop(),Ne(Ue(o.join("/")))}var oe=class{constructor(e,r,o,n,i){this.callerName=e;this.fileName=r;this.lineNumber=o;this.columnNumber=n;this.fullTrace=i}};var gt=t=>typeof t=="object"&&t!==null&&["node","deno","bun","browser"].every(e=>typeof t[e]=="number"),W=class{constructor({node:e,deno:r,bun:o,browser:n,defaults:i}){this.node=e||2,this.deno=r||2,this.bun=o||2,this.browser=n||2,this.defaults=i||2}};function C(t){var g;let e=(g=Error().stack)==null?void 0:g.split(`
`).map(p=>p.trim()).slice(1);if(typeof t!="number"){let p=t;if(t instanceof W)t=t[d.detectEnv()]||t.defaults;else if(gt(p))t=new W(p),t=t[d.detectEnv()]||t.defaults;else return console.warn("[lookUpInStack] Invalid `at` value. Expected number or LookSetup-compatible object, received:",t),{fullTrace:e}}let r=e.length-1;if(t<0||t>r||!Number.isInteger(t))return console.warn(`[lookUpInStack] invalid \`at\` index, must be between 0 and ${r}; received: ${t}`),{fullTrace:e};let o=e[t].replace(/^at/,"").trim().split(" "),n=o.length;if(!o||n===0)return console.warn(`[lookUpInStack] No valid stack trace found at index ${t}`),{fullTrace:e};let i=n>1,s=i?o[0]:"<unknown>",a=i?o.slice(1).join(""):o[0],c=a.split(":"),l=c.length,u=l>2?c[l-2]:c[l-1].replace(")",""),f=l>2?c[l-1]:"0";return new oe(s,a.replace(/\:\d*\:\d*$/,""),u,f.replace(")",""),e)}var De,Ae,d=class{static detectEnv(){var e;if(typeof window!="undefined"&&typeof document!="undefined")return"browser";if(typeof Deno!="undefined")return"deno";if(typeof Bun!="undefined")return"bun";if(typeof process!="undefined"&&(process!=null&&process.versions)&&((e=process==null?void 0:process.versions)!=null&&e.node))return"node"}};d.basePath=Oe(((Ae=(De=new Error)==null?void 0:De.stack)!=null?Ae:"")[1]||"");var z={reset:"color: inherit; background-color: inherit; font-weight: normal; font-style: normal; text-decoration: none; opacity: 1; filter: none;",bold:"font-weight: bold;",dim:"opacity: 0.6;",italic:"font-style: italic;",underline:"text-decoration: underline;",inverse:"filter: invert(100%);",hidden:"opacity: 0;",strikethrough:"text-decoration: line-through;",black:"color: black;",red:"color: red;",green:"color: green;",yellow:"color: yellow;",blue:"color: blue;",magenta:"color: magenta;",cyan:"color: cyan;",white:"color: white;",gray:"color: gray;",grey:"color: grey;",blackBright:"color: #3f3f3f;",redBright:"color: #ff0000;",greenBright:"color: #00ff00;",yellowBright:"color: #ffff00;",blueBright:"color: #0000ff;",magentaBright:"color: #ff00ff;",cyanBright:"color: #00ffff;",whiteBright:"color: #ffffff;",bgBlack:"background-color: black;",bgRed:"background-color: red;",bgGreen:"background-color: green;",bgYellow:"background-color: yellow;",bgBlue:"background-color: blue;",bgMagenta:"background-color: magenta;",bgCyan:"background-color: cyan;",bgWhite:"background-color: white;",bgGray:"background-color: gray;",bgGrey:"background-color: grey;",bgBlackBright:"background-color: #3f3f3f;",bgRedBright:"background-color: #ff0000;",bgGreenBright:"background-color: #00ff00;",bgYellowBright:"background-color: #ffff00;",bgBlueBright:"background-color: #0000ff;",bgMagentaBright:"background-color: #ff00ff;",bgCyanBright:"background-color: #00ffff;",bgWhiteBright:"background-color: #ffffff;"};var _e=Pe(require("chalk"));function Ve(t,...e){return`[mtxt-style[${t}]]${e.join("")}[mtxt-style-end]`}var yt=/(\[mtxt-style\[[^\]]+\]\])|(\[mtxt-style-end\])/g,Ke=/\[mtxt-style\[([^\]]+)\]\]/,dt="[mtxt-style-end]";function We(t){let e=t.split(yt).filter(Boolean),r=[],o=[],n=i=>{o.length>0?o[o.length-1].content.push(i):r.push(i)};for(let i of e)if(Ke.test(i)){let[,s]=i.match(Ke),a={style:s.split(" "),content:[]};o.push(a)}else if(i===dt){let s=o.pop();n(s)}else n(i);return r}function ne(t){return t.map(r=>{if(typeof r=="string")return r;let o=ne(r.content);return r.style.reduce((i,s)=>{var a;return(a=i[s])!=null?a:i},_e.default)(o)}).join("")}function ze(t){let e="",r=[],o=(n,i="")=>{for(let s of n)if(typeof s=="string")e+="%c"+s,r.push(i);else{let a=s.style.map(ht).join("; ")+";";o(s.content,a)}};return o(t),[e,r]}function ht(t){return z[t]||""}function bt(t){return function(...e){return Ve(t,...e)}}var Ge={};for(let t of Object.keys(z))Ge[t]=bt(t);var G=Ge;var{green:hr,bold:br,gray:wt}=G;function Je(t="",e={}){var f,g,p;let r=se(80),o=(f=e.char)!=null?f:"\u2500",n=(g=e.color)!=null?g:wt,i=" ".repeat((p=e.padding)!=null?p:1),s=t?`${i}${t.trim()}${i}`:"",a=Math.max(0,r-s.length),c=Math.floor(a/2),l=a-c,u=o.repeat(c)+s+o.repeat(l);return n(u)}function se(t=80){var r,o;switch(d.detectEnv()){case"bun":return((r=process.stdout)==null?void 0:r.columns)||t;case"node":return((o=process.stdout)==null?void 0:o.columns)||t;case"deno":return Deno.consoleSize().columns||t;case"browser":let n;try{return n=Math.floor(window.innerWidth/8),n>0?n:t}catch(i){return t}default:return t}}function N(t,e=d.detectEnv()){let r="",o=[];t(Je,G,function(c){o.push(c)},function(c){r=c});let s=We(o.flat().join(r));return e==="browser"?ze(s).flat():[ne(s)]}function He(t,e){return{header(r,o){let n=t.getTheme(r),i=e[n.color],s=e[n.headerStyle||"bold"];return[`${s(i(`${n.icon} [${r.toUpperCase()}]`))} ${e.whiteBright(o.join(" "))}`]},trace(r,o){let n=t.getTheme(r),i=[];return i.push(`${e[n.metaLabelColor||"white"](`\u{1F4CC} StackTraceInfo:
`)}`),o.callerName&&i.push(`    \u2022 ${e.bold("Caller:")}   ${o.callerName}`),o.fileName&&i.push(`    \u2022 ${e.bold("File:")}     ${o.fileName}`),o.lineNumber&&i.push(`    \u2022 ${e.bold("Line:")}     ${o.lineNumber}`),o.columnNumber&&i.push(`    \u2022 ${e.bold("Column:")}   ${o.columnNumber}`),i},fullTrace(r,o){let n=t.getTheme(r),i=[];return i.push(`${e[n.metaLabelColor||"white"](`\u{1F4DC} Full Trace:
`)}`),Array.isArray(o)&&o.length>0?i.push(...o.map(s=>`   - ${s}`)):i.push("   No stack trace available."),i},context(r,o){let n=t.getTheme(r),i=[];if(i.push(`${e[n.contextColor||"white"]("\u{1F4E6} Context:")}`),!o)return["   - No context available."];if(typeof o!="object"||Object.keys(o).length!==0)return[`   - ${o}`];let s=Object.entries(o).map(([a,c])=>`   - ${a}: ${c}`).join("");return s.trim()==""?[" - No context available."]:i.concat(s)},config(r,o){let n=t.getTheme(r),i=[];return i.push(`
${e[n.configColor||"white"]("\u2699\uFE0F  Config:")}`),o?typeof o!="object"?[`   - ${o}`]:i.concat(Object.entries(o).map(([s,a])=>`   - ${s}: ${a}`)):["   - No config available."]},separator(r,o="",n="center",i){var ye,de,he,be,we,ke,Te;let s=t.getTheme(r),a=(ye=s.separatorChar)!=null?ye:"-",c=e[s.color],l=se(),u=e[(he=(de=i==null?void 0:i.style)!=null?de:s.separatorStyle)!=null?he:"bold"],f=(we=(be=i==null?void 0:i.transform)!=null?be:s.textTransform)!=null?we:"none",g=(Te=(ke=i==null?void 0:i.icon)!=null?ke:s.showIconInSeparator)!=null?Te:!0,p=o.trim();f==="uppercase"&&(p=p.toUpperCase()),f==="capitalize"&&(p=p[0].toUpperCase()+p.slice(1)),g&&(p=`${s.icon} ${p}`);let T=`${n=="center"?" ":""}${p} `,h=Math.max(0,l-T.length),x=n==="center"?Math.floor(h/2):0,ee=Math.floor(h)-x,te=(a.repeat(x)+T+a.repeat(ee)).split("");for(;l-1<te.length;)te.pop();return[c(u(te.join("")))]}}}var ie={};$e(ie,{isAsyncFunction:()=>S,isNegativeNumber:()=>pt,isNumber:()=>ft,isObject:()=>K,isPositiveNumber:()=>E,isValidDate:()=>M,resolveType:()=>J});function J(t){if(t===null)return"null";if(t===void 0)return"undefined";if(Array.isArray(t))return"array";let e=typeof t;return["string","number","boolean","function"].includes(e)?e:e==="object"?"object":"unknown"}var Ye={dev(t,e,r){let o=N((n,i,s,a)=>{a(`
`);let{dim:c,bold:l}=i,u=t.toObject(),f=He(e,i),g=u.level,p=Array.isArray(u.message)?u.message:[u.message],T=u.meta,h=r[g];s(""),s(f.separator(g,`[${[g]}]`,"left",{transform:"uppercase",style:"bold"})),s(""),s(p.join()),h.showTraceInfo&&(s(""),f.trace(g,T).forEach(s)),h.showFullTrace&&(s(""),f.fullTrace(g,T.fullTrace).forEach(s)),h.showContext&&(s(""),f.context(g,u.context).forEach(s)),h.showConfig&&(s(""),f.config(g,u.config).forEach(s));let x="";h.showEnv&&(x+=`${d.detectEnv()}, `,x=[x[0].toUpperCase(),x.split("").splice(1).join("").toLowerCase()].join("")),h.showTimestamp&&(x+=`At ${M(u.timestamp)?new Date(u.timestamp).toLocaleString():new Date().toLocaleString()}`),s(""),s(x),s(n("",{char:l("\u2500"),color:ee=>l(c(ee))}))});console.log(...o)}};var H=class{constructor(e,r){this.themes=r,this.currentTheme=e}use(e){if(!(e in this.themes))throw new Error(`Theme "${e}" not found.`);this.currentTheme=e}getTheme(e){return m(m({},this.themes.common||{}),this.themes[this.currentTheme][e])}get current(){return this.currentTheme}listThemes(){return Object.keys(this.themes)}};var qe={common:{contextColor:"white",configColor:"white",metaLabelColor:"white",separatorChar:"\u2501",headerStyle:"white"},info:{icon:"\u{1F7E6}",color:"blue",traceColor:"cyan"},warn:{icon:"\u26A0\uFE0F",color:"yellow",traceColor:"yellow"},error:{icon:"\u{1F7E5}",color:"red",traceColor:"red"},success:{icon:"\u2705",color:"green",traceColor:"green"},failure:{icon:"\u274C",color:"yellowBright",traceColor:"yellowBright"},fatal:{icon:"\u{1F480}",color:"redBright",traceColor:"redBright"},trace:{icon:"\u{1F50D}",color:"magenta",traceColor:"cyan"},profile:{icon:"\u23F1\uFE0F",color:"cyan",traceColor:"cyan"}};var Ze=new H("default",{default:qe});var Xe=new B({name:"log-on-console-policy",phase:"core",handle:function(t,e,r){Ye.dev(t,Ze,e.format),r()}});var Qe={createConfig:Me,createFormating:Fe,policies:[Xe]};var ae={default:Qe};function et(t){if(!ae[t])throw`[Monitext[getPolicyRecord]] The requested record "${t}" could not be found;
[Availables] ${Object.keys(ae).map(function(e){return`
   - ${e}`}).join("")}`;return ae[t]}function w(t){let e=Math.floor(t/1e3),r=Math.floor(e/3600),o=e%3600,n=Math.floor(o/60),i=o%60,s=t%1e3;return{hours:r,minutes:n,seconds:i,milliseconds:s}}function k(t){let e=[],r=(o,n,i)=>`${o} ${o===1?n:i}`;return t.hours&&e.push(r(t.hours,"hour","hours")),t.minutes&&e.push(r(t.minutes,"minute","minutes")),t.seconds&&e.push(r(t.seconds,"second","seconds")),(t.milliseconds||e.length===0)&&e.push(r(t.milliseconds,"millisecond","milliseconds")),e.join(" ")}function tt(t){if(t instanceof Date&&!isNaN(t.getTime()))return t;if(typeof t=="string"||typeof t=="number"){let e=new Date(t);return isNaN(e.getTime())?null:e}return null}var P,le=class le{constructor(e={}){Ee(this,P);Re(this,P,e),this._struct=Object.assign({},e),typeof(this==null?void 0:this.validate)=="function"&&this.validate()}toObject(){return A(this._struct)}clone(e={}){return new this.constructor(m(m({},this.toObject()),e))}patch(e={}){return Object.assign(this._struct,e),typeof(this==null?void 0:this.validate)=="function"&&this.validate(),this}describe(){let e={},r=D(this,P);for(let o of Object.keys(D(this,P))){let n=D(this,P)[o],i=J(n);i==="object"&&n&&typeof n=="object"&&!Array.isArray(n)?e[o]={type:"object",required:!0,properties:Object.fromEntries(Object.entries(n).map(([s,a])=>[s,{type:J(a),default:a,required:a!=null&&a!=null}]))}:e[o]={type:i,default:n,required:!0}}return e}pick(...e){let r=this.toObject(),o={};for(let n of e)o[n]=r[n];return o}omit(...e){let r=this.toObject(),o=m({},r);for(let n of e)delete o[n];return o}pickStruct(...e){var n;let r=this,o=this.pick(...e);return new class extends le{constructor(){super(...arguments);this.validate=(n=r==null?void 0:r.validate)==null?void 0:n.bind(this)}}(o)}};P=new WeakMap;var ce=le;function I(t,e){class r extends ce{constructor(n){super(m(m({},t),n))}validate(){e&&e.call(this._struct)}}return r}var kt={install:void 0},rt=I(kt);var Tt={ready:!1,level:"info",subLevels:[],context:{},config:{},message:[],meta:void 0,env:d.detectEnv(),timestamp:void 0,identifyer:void 0},$=I(Tt,function(){var t,e;if(typeof this.identifyer!="symbol")throw new TypeError(v("LogInstance",'expected a symbol as "identifyer"; received: ',(t=this.identifyer)==null?void 0:t.toString()));if(typeof this.timestamp!="string"||!M(this.timestamp))throw new TypeError(v("LogInstance",'expected an ISO string or any valid form of date as "timestamp"; received: ',(e=this.timestamp)==null?void 0:e.toString()))});var Y=class{constructor(e){this.subscribers=[];this.levelHandlers={};this.config=U(e,"config","format")}handle(e){return y(this,null,function*(){(this.levelHandlers[e.toObject().level]||[]).forEach(o=>o(e,this.config)),this.subscribers.forEach(o=>o(e,this.config))})}subscribe(e){this.subscribers.push(e)}on(e,r){this.levelHandlers[e]||(this.levelHandlers[e]=[]),this.levelHandlers[e].push(r)}};var xt={fn:function(){}},St=xt.fn;S(St);var ue=class{constructor(e,r=!1){this.name=e;this.ready=r}},fe=class{constructor(e,r){this.jobs=e;this.submit=r;this.scheduled=!1}},q=class{constructor(e,r=10){this.chainStrength=r;this.ref=new fe({},e)}initJobs(e){let r={};for(let o of e)r[o]=new ue(o,!0);return this.ref.jobs=r,this.scheduleIfReady(),this.createProxy()}scheduleIfReady(){this.ref.scheduled!==!0&&(this.ref.scheduled=!0,this.ref.interval=setInterval(()=>{Object.values(this.ref.jobs).every(r=>r.ready===!0)&&(this.submit(),clearInterval(this.ref.interval))},this.chainStrength))}submit(){return y(this,null,function*(){if(typeof this.ref.submit=="function"){let e=yield this.ref.submit(this.ref.param);this.ref.resolveCallback&&this.ref.resolveCallback(e)}})}then(e,r){this.ref.resolveCallback=e}createProxy(){return new Proxy(this,{get:(e,r,o)=>{let n=Reflect.get(e,r,o);return typeof n=="function"&&this.ref.jobs[r]?(this.ref.jobs[r].ready=!1,(...i)=>(y(this,null,function*(){let s=n;S(n)?yield s.apply(e,i):s.apply(e,i),this.ref.jobs[r].ready=!0,this.scheduleIfReady()}),this.createProxy())):n}})}};var Z=class extends q{constructor({log:e,onSubmit:r}){return super(r),this.ref.param=e.toObject(),this.initJobs(["context","config"])}context(e){return this.ref.param.context=e,delete this.context,this.createProxy()}config(e){this.ref.param.config=e,delete this.config}};var j=class t{constructor(e,r,o){this.ok=e,this.value=r,this.error=o}static ok(e){return new t(!0,e)}static fail(e){return new t(!1,void 0,e)}};var X=class{constructor(e,r,o){this.target=r;this.callRecord=[];S(e)?this.body=this.loadAsAsync(e,o):this.body=this.loadAsSync(e,o)}build(){return this.body}updateProfile(e,r,o,n){return y(this,null,function*(){if(this.callRecord.push(e),this.callRecord.length!==o)return;let i=k(w(Math.min(...this.callRecord))),s=k(w(Math.max(...this.callRecord))),a=this.callRecord.reduce((p,T)=>p+T),c=k(w(a/o)),l=k(w(a)),f=(this.callRecord.filter(p=>p<r).length/o*100).toFixed(1)+"%",g=`[Profiler] ${o} calls completed in ${l}:

 \u2022 Average time per call: ${c}
 \u2022 Fastest: ${i}, Slowest: ${s}
 \u2022 ${f} of calls completed within expected time range (expected: \u2264 ${k(w(r))})`;this.emit("info",g,n)})}repportProfilingError(e,r){return y(this,null,function*(){this.emit("error",`[Profiler][Error: (${e.name})]: ${e.message}`,r)})}reportTimingDiscrepancy(e,r,o){return y(this,null,function*(){let n=w(e),i=w(r);this.emit("warn",`[Profiling Warning] Execution time exceeded. Expected: ${k(i)}, actual: ${k(n)}`,o)})}emit(e,r,o){this.target.handle(new $({level:"profile",subLevels:[e],message:Array.isArray(r)?r:[r],meta:o,ready:!0,identifyer:Symbol(),timestamp:new Date().toISOString()}))}loadAsAsync(e,{expectDuration:r,forAverageOf:o}){let n=this;return(...i)=>y(this,null,function*(){let s,a,c,l,u=C({node:2,deno:2,bun:3,browser:2,defaults:2});try{c=c=Date.now(),s=yield e(...i),l=Date.now()-c}catch(f){l=Date.now()-c,a=f}return a?(n.repportProfilingError(a,u),j.fail(a)):(y(this,null,function*(){E(r)&&r<l&&n.reportTimingDiscrepancy(l,r,u),E(o)&&n.updateProfile(l,r,o,u)}),j.ok(s))})}loadAsSync(e,{expectDuration:r,forAverageOf:o}){let n=this;return(...i)=>{let s,a,c,l,u=C({node:2,deno:2,bun:2,browser:2,defaults:2});try{c=c=Date.now(),s=e(...i),l=Date.now()-c}catch(f){l=Date.now()-c,a=f}return a?(n.repportProfilingError(a,u),j.fail(a)):(y(this,null,function*(){E(r)&&r<l&&n.reportTimingDiscrepancy(l,r,u),E(o)&&n.updateProfile(l,r,o,u)}),j.ok(s))}}};var pe=require("acorn"),me=require("estree-walker"),ge=Pe(require("astring"));var Q=class{constructor(e){this.fn=e;this.keywords={useThrow$:"__throw$",useTrace$:"__trace$",traceDec$:"__traced$",fnTracer$:"__fnTracer$",makeResult$:"__mkResult$",passedArgs$:"__callArgs$"};this.traceWrapperFnBody=`function ${this.keywords.traceDec$}(fn) {
        fn.${this.keywords.useTrace$} = ${this.keywords.fnTracer$}
        fn.${this.keywords.useThrow$} = (e) => { throw new Error(e); }
        return fn;
    }`;this.runCode=(e,r={})=>{let o=Object.keys(r),n=Object.values(r);return new Function(...o,`"use strict";
${e}`)(...n)}}build(){let e=this,r=`(${this.removeSemiColon(this.fn.toString())})(...${this.keywords.passedArgs$})`,o=`${this.wrapFunctionDeclarationsWith(this.wrapFnCallsWith(r))}`,n=`
        Function.prototype.${this.keywords.useTrace$} = ${this.keywords.fnTracer$}
        Function.prototype.${this.keywords.useThrow$} = (e)=> { throw new Error(e); }
        ${this.traceWrapperFnBody}
        `,i=S(this.fn),s=[],a={[this.keywords.fnTracer$]:this.makeFnTracer(s),[this.keywords.makeResult$]:null},c=`(${i?"async":""} function (){
                try {                
                    ${n}
                    const result = ${i?"await":""} ${o}
                    ${this.keywords.makeResult$}({ ok: true, value: result })
                } catch (e){            
                    console.log(\`[TRACE ERROR (\${e.name})] \${e.message}\`)
                    ${this.keywords.makeResult$}({ ok: false, error: e })
                }
            })()`;return i?function(l){return y(this,null,function*(){return yield new Promise(u=>{a[e.keywords.makeResult$]=u,a[e.keywords.passedArgs$]=[l],e.runCode(c,a),console.log(JSON.stringify(s,null,2))}).then(u=>re(m({},u||{}),{exec:s}))})}:function(l){let u;return a[e.keywords.passedArgs$]=[l],a[e.keywords.makeResult$]=f=>{u=f},e.runCode(c,a),console.log(JSON.stringify(s,null,2)),re(m({},u||{}),{exec:s})}}removeSemiColon(e){return e.trimEnd().replace(/\;$/,"")}uuid(){return Date.now()}makeFnTracer(e){let r=this;return function(o,n=this){return function(...i){let s={};e.push(s),s.start=Date.now(),s.label=o||(n==null?void 0:n.name)||n.toString(),s.arguments=i;try{let a=n.apply(this,i);return s.result=a,s.duration=`${(Date.now()-s.start).toFixed(2)} ms`,a}catch(a){s.error={message:`Tracing ${a==null?void 0:a.name} ${a==null?void 0:a.message}`},s.duration=`${(Date.now()-s.start).toFixed(2)} ms`,n[r.keywords.useThrow$](a)}}}}wrapFunctionDeclarationsWith(e){let r=this,o=(0,pe.parse)(e,{ecmaVersion:2022,sourceType:"module"}),n=[];(0,me.walk)(o,{enter(i,s){var a,c;if(i.type==="VariableDeclarator"&&(((a=i.init)==null?void 0:a.type)==="ArrowFunctionExpression"||((c=i.init)==null?void 0:c.type)==="FunctionExpression")&&(i.init={type:"CallExpression",callee:{type:"Identifier",name:r.keywords.traceDec$},arguments:[i.init]}),i.type==="FunctionDeclaration"&&(s==null?void 0:s.type)==="Program"){let{id:l,params:u,body:f,generator:g,async:p}=i,T={type:"FunctionExpression",id:l,params:u,body:f,generator:g,async:p},h={type:"VariableDeclaration",kind:"const",declarations:[{type:"VariableDeclarator",id:l,init:{type:"CallExpression",callee:{type:"Identifier",name:r.keywords.useTrace$},arguments:[T]}}]};n.push({node:i,replacement:h})}}});for(let{node:i,replacement:s}of n){let a=o.body.indexOf(i);a!==-1&&o.body.splice(a,1,s)}return ge.generate(o)}wrapFnCallsWith(e){let r=this,o=(0,pe.parse)(e,{ecmaVersion:2022,sourceType:"module"});return(0,me.walk)(o,{enter(n,i){if(n.type==="CallExpression"&&n.callee.type==="Identifier"){let s=n.callee;n.callee={type:"CallExpression",callee:{type:"MemberExpression",object:s,property:{type:"Identifier",name:r.keywords.useTrace$},computed:!1,optional:!1},arguments:[{type:"Literal",value:s!=null&&s.name?"string":"null",raw:s!=null&&s.name?`"${s==null?void 0:s.name}"`:void 0}],optional:!1}}}}),ge.generate(o)}};var O=class{constructor(e,r){this.bus=e;this.mode=r;this.commonLevel=["info","warn","error","fatal","success","failure"];for(let o of this.commonLevel)this[o]=r==="compact"?this.createCompactLogEmitter(o):this.createChainableLogEmitter(o)}createCompactLogEmitter(e){return(r,o)=>{let{config:n,context:i}=o||{};i&&(i=typeof i=="object"?i:{$value:i});let s=new $({level:e,message:[r],context:i,meta:C(2),config:n,ready:!0,identifyer:Symbol(),timestamp:new Date().toISOString()});return this.bus.handle(s),s}}createChainableLogEmitter(e){let r=this;return(...o)=>new Z({log:new $({message:o,level:e,meta:C({bun:2,node:2,deno:2,browser:2,defaults:2}),ready:!0,identifyer:Symbol(),timestamp:new Date().toISOString()}),onSubmit(i){let{context:s}=i||{};s&&(i.context=typeof s=="object"?s:{$value:s}),r.bus.handle(new $(i))}})}profile(e,r){return new X(e,this.bus,r).build()}trace(e,r){return new Q(e).build()}};var vt={lookUpInStack:C,parseDate:tt,extractKeys:U,check:ie,convertTime:w,writeTimeString:k},Ct={createStructFromShape:I,createConfigResolver:L,writeColoredString:N,PolicyInstance:rt,LogInstance:$,Config:b};function $t(t){var n,i;let e=(i=(n=t==null?void 0:t.load)==null?void 0:n.flat().filter(s=>s instanceof B))!=null?i:[],r=new Y(U(t,"config","format"));return r.subscribe((s,a)=>y(null,null,function*(){try{yield V(e,s,a,"pre"),yield V(e,s,a,"core"),yield V(e,s,a,"post")}catch(c){console.warn(...N(function(l,u,f){let{bold:g}=u;f(l("MONITEXT - SYS GUARD")),f(g(v("MonitextFailSafe",`A Critical Error as occured inside Monitext Logging Policy;
Cause: ${c.message}
${c==null?void 0:c.stack}`))),f(l("MONITEXT - SYS GUARD"))}))}})),{mtxt:new O(r,"compact"),monitext:new O(r,"chainable")}}
//!!! TO DO REMOVE THIS DOWN HERE
